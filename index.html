<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BONSAID — Album Showcase</title>
  <style>
    :root{
      --bg:#0d0d0d; --panel:#141414; --ink:#e9e5da; --muted:#a89f8b; --gold:#d1a85a; --accent:#8ccf9e; --emerald:#5ac29a; --danger:#ff6b6b;
    }
    *{box-sizing:border-box}
    body{margin:0;background:url('b94d7e21-7ddc-42cc-97fd-6cf2f2a15882.png') center/cover fixed, radial-gradient(60% 100% at 50% 0%, #162012, #0b0b0b 50%) fixed;color:var(--ink);font:16px/1.5 system-ui,Segoe UI,Roboto,Inter,Arial}
    a{color:var(--gold)}
    header{padding:28px 20px 10px;display:flex;align-items:center;gap:16px;justify-content:space-between;border-bottom:1px solid #222;background:linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 50%, #1a1a1a 100%);backdrop-filter:blur(10px)}
    .brand{display:flex;align-items:center;gap:14px}
    .logo{width:46px;height:46px;border-radius:12px;background:conic-gradient(from 120deg,#1a1a1a,#26321f,#1a1a1a);display:grid;place-items:center;box-shadow:0 0 0 1px #2a2a2a inset, 0 8px 24px rgba(0,0,0,.45)}
    .logo::before{content:"";width:24px;height:24px;border-radius:50%;background:radial-gradient(#7dcf9b,#1e3a27 70%);filter:blur(.2px)}
    h1{margin:0;font-size:clamp(26px,3.4vw,42px);letter-spacing:.06em}
    .subtitle{margin-top:4px}
    .player-title{color:var(--accent);font-size:14px;font-weight:600;letter-spacing:.05em}
    .eq-title{color:var(--muted);font-size:11px;letter-spacing:.08em;margin-top:2px}
    .stamp{color:var(--muted);font-size:12px;letter-spacing:.12em;text-transform:uppercase}

    .wrap{display:grid;grid-template-columns:360px 1fr;gap:24px;padding:20px;max-width:1200px;margin:0 auto}
    @media (max-width: 980px){.wrap{grid-template-columns:1fr}}
    @media (max-width: 768px){.gallery{grid-template-columns:repeat(2,1fr)}}
    @media (max-width: 480px){.gallery{grid-template-columns:1fr}}

    .panel{background:linear-gradient(180deg,rgba(255,255,255,.02),transparent),var(--panel);border:1px solid #242424;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.35);overflow:hidden}

    /* Slideshow */
    .slideshow-container{padding:14px;position:relative}
    .slideshow{position:relative;aspect-ratio:3/4;border-radius:12px;overflow:hidden;min-height:400px}
    .slide{position:absolute;top:0;left:0;width:100%;height:100%;background:#111 center/100% 100% no-repeat;display:grid;place-items:end stretch;opacity:0;transition:opacity 0.5s ease-in-out}
    .slide.active{opacity:1}
    .slide .badge{position:absolute;right:10px;top:10px;background:rgba(209,168,90,.12);border:1px solid rgba(209,168,90,.35);color:var(--gold);padding:4px 8px;border-radius:999px;font-size:12px;letter-spacing:.08em;text-transform:uppercase}
    .slideshow-controls{display:flex;align-items:center;justify-content:center;gap:12px;margin-top:12px}
    .slide-btn{appearance:none;border:1px solid #2a2a2a;background:#181818;color:var(--ink);padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:600;font-size:16px;transition:all 0.2s ease}
    .slide-btn:hover{background:#1f1f1f;border-color:#3a3a3a}
    .slide-indicators{display:flex;gap:6px}
    .indicator{width:8px;height:8px;border-radius:50%;background:#2a2a2a;cursor:pointer;transition:all 0.2s ease}
    .indicator.active{background:var(--gold)}

    /* Player */
    .player{padding:16px;display:grid;gap:14px}
    .row{display:flex;align-items:center;gap:10px}
    button{appearance:none;border:1px solid #2a2a2a;background:#181818;color:var(--ink);padding:12px 18px;border-radius:12px;cursor:pointer;font-weight:600;min-height:44px;min-width:44px;touch-action:manipulation}
    button:hover{background:#1f1f1f}
    button.primary{background:linear-gradient(180deg,#1b2b21,#142017);border-color:#2a3a2e;padding:14px 20px;font-size:16px}
    .track.playing{background:#1a2b21;border-color:#3a4a3e}
    .track.queued{background:#2a1b21;border-color:#3a2a2e}
    .track.loaded{background:#1a1a2e;border-color:#2a2a3e;box-shadow:0 0 0 1px #3a3a4e inset}
    .meter, .seek{flex:1;height:12px;background:#0f0f0f;border-radius:999px;border:1px solid #2a2a2a;position:relative;cursor:pointer;touch-action:manipulation}
    .meter .fill, .seek .fill{position:absolute;inset:0 100% 0 0;background:linear-gradient(90deg,#2f6c46,#7bd0a0);border-radius:inherit}
    .knob{width:44px}
    .control{display:grid;gap:8px;padding:8px;background:rgba(20,20,20,0.5);border-radius:8px;border:1px solid #333;transition:all 0.2s ease}
    .control:hover{background:rgba(30,30,30,0.7);border-color:#444}
    .control label{font-size:12px;color:var(--gold);font-weight:600;text-transform:uppercase;letter-spacing:0.5px;text-align:center}
    .slider-container{display:flex;align-items:center;gap:8px;width:100%;justify-content:center}
    .eq-btn{width:28px;height:28px;border-radius:50%;background:linear-gradient(135deg,#2a2a2a,#1a1a1a);border:2px solid #3a3a3a;color:var(--gold);font-size:16px;font-weight:bold;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all 0.2s ease;box-shadow:0 2px 4px rgba(0,0,0,0.3)}
    .eq-btn:hover{background:linear-gradient(135deg,#3a3a3a,#2a2a2a);border-color:var(--gold);transform:scale(1.1);box-shadow:0 4px 8px rgba(0,0,0,0.4)}
    .eq-btn:active{transform:scale(0.95);box-shadow:0 1px 2px rgba(0,0,0,0.5)}
    .value-display{font-size:11px;color:var(--accent);font-weight:700;text-align:center;background:rgba(139,195,74,0.1);padding:2px 6px;border-radius:4px;border:1px solid rgba(139,195,74,0.3);min-width:40px}
    input[type=range]{width:120px;height:44px;touch-action:manipulation;-webkit-appearance:none;appearance:none;background:transparent;cursor:pointer;outline:none}
    input[type=range]::-webkit-slider-track{background:linear-gradient(90deg,#2a2a2a,#1a1a1a,#2a2a2a);height:16px;border-radius:8px;border:3px solid #3a3a3a;box-shadow:inset 0 3px 6px rgba(0,0,0,0.4), 0 2px 4px rgba(255,255,255,0.1), inset 0 0 0 1px rgba(139,195,74,0.2)}
    input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;appearance:none;height:28px;width:28px;border-radius:50%;background:linear-gradient(135deg,var(--gold),#b8941f);cursor:pointer;border:3px solid #1a1a1a;box-shadow:0 4px 8px rgba(0,0,0,0.4), 0 0 0 2px rgba(209,168,90,0.3), inset 0 1px 2px rgba(255,255,255,0.2);transition:all 0.2s ease}
    input[type=range]::-webkit-slider-thumb:hover{transform:scale(1.1);box-shadow:0 6px 12px rgba(0,0,0,0.5), 0 0 0 3px rgba(209,168,90,0.5), inset 0 1px 2px rgba(255,255,255,0.3)}
    input[type=range]::-webkit-slider-thumb:active{transform:scale(1.05);box-shadow:0 2px 4px rgba(0,0,0,0.6), 0 0 0 4px rgba(209,168,90,0.7), inset 0 1px 2px rgba(255,255,255,0.4)}
    input[type=range]::-moz-range-track{background:linear-gradient(90deg,#2a2a2a,#1a1a1a,#2a2a2a);height:16px;border-radius:8px;border:3px solid #3a3a3a;box-shadow:inset 0 3px 6px rgba(0,0,0,0.4), 0 2px 4px rgba(255,255,255,0.1), inset 0 0 0 1px rgba(139,195,74,0.2)}
    input[type=range]::-moz-range-thumb{height:28px;width:28px;border-radius:50%;background:linear-gradient(135deg,var(--gold),#b8941f);cursor:pointer;border:3px solid #1a1a1a;box-shadow:0 4px 8px rgba(0,0,0,0.4), 0 0 0 2px rgba(209,168,90,0.3), inset 0 1px 2px rgba(255,255,255,0.2);transition:all 0.2s ease}
    input[type=range]::-moz-range-thumb:hover{transform:scale(1.1);box-shadow:0 6px 12px rgba(0,0,0,0.5), 0 0 0 3px rgba(209,168,90,0.5), inset 0 1px 2px rgba(255,255,255,0.3)}
    input[type=range]::-moz-range-thumb:active{transform:scale(1.05);box-shadow:0 2px 4px rgba(0,0,0,0.6), 0 0 0 4px rgba(209,168,90,0.7), inset 0 1px 2px rgba(255,255,255,0.4)}

    /* Tracks */
    .tracks{padding:14px;display:grid;gap:12px}
    .track{display:grid;grid-template-columns:1fr auto;gap:8px;align-items:center;background:#101010;border:1px solid #242424;border-radius:12px;padding:10px}
    .track small{display:block;color:var(--muted)}
    .track input[type=file], .track input[type=url]{max-width:100%}

    canvas{width:100%;height:200px;background:#0b0b0b;border-radius:12px;border:1px solid #222}
    footer{padding:18px 20px;color:var(--muted);text-align:center}
    /* Mobile-first adjustments */
  .sticky-player{position:fixed;left:0;right:0;bottom:0;background:linear-gradient(180deg,rgba(255,255,255,.02),transparent),var(--panel);border-top:1px solid #242424;box-shadow:0 -10px 30px rgba(0,0,0,.45);z-index:9999;padding:10px 12px;display:none}
  .sticky-player .row{display:flex;align-items:center;gap:10px}
  .sticky-player .seek{flex:1;height:8px;background:#0f0f0f;border-radius:999px;border:1px solid #2a2a2a;position:relative}
  .sticky-player .seek .fill{position:absolute;inset:0 100% 0 0;background:linear-gradient(90deg,#2f6c46,#7bd0a0);border-radius:inherit}
  .sticky-player .title{color:var(--muted);font-size:12px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:30vw}

  @media (max-width: 980px){
    body{padding-bottom:200px} /* Increased to accommodate taller visualizer */
    .wrap{grid-template-columns:1fr;gap:16px}
    .player{display:none} /* hide desktop player on mobile */
    .sticky-player{display:block}
    header{padding:20px 16px 8px;flex-direction:column;align-items:flex-start;gap:12px}
    .brand{flex-direction:row;align-items:center;gap:12px}
    h1{font-size:clamp(22px,4vw,28px);line-height:1.2}
    .subtitle{margin-top:6px}
    .player-title{font-size:13px}
    .eq-title{font-size:10px;margin-top:1px}
    .stamp{font-size:10px;margin-top:4px}
  }
</style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="logo" aria-hidden="true"></div>
      <div>
        <h1>BONSAID — Album Showcase</h1>
        <div class="subtitle">
          <div class="player-title">Bass‑Boost Player</div>
          <div class="eq-title">(Web Audio EQ)</div>
        </div>
        <div class="stamp">An AeroVista Production · EchoVerse Audio</div>
      </div>
    </div>
  </header>

  <main class="wrap">
    <!-- Left: Album Covers -->
    <section class="panel">
      <div class="slideshow-container">
        <div class="slideshow" id="slideshow">
          <!-- Slides will be dynamically generated from slideshow directory -->
        </div>
        <div class="slideshow-controls">
          <button id="prevSlide" class="slide-btn">‹</button>
          <div class="slide-indicators" id="indicators"></div>
          <button id="nextSlide" class="slide-btn">›</button>
        </div>
      </div>
    </section>

    <!-- Right: Player / Controls / Tracks -->
    <section class="panel">
      <div class="player">
        <audio id="audio" crossorigin="anonymous"></audio>
        <div class="row">
          <button id="prev" title="Previous Track">⏮</button>
          <button id="play" class="primary">► Play</button>
          <button id="next" title="Next Track">⏭</button>
          <div class="seek" title="Seek">
            <div class="fill" id="seekFill"></div>
          </div>
          <div id="time" style="min-width:90px;text-align:right;color:var(--muted)">0:00 / 0:00</div>
        </div>
        <div class="row">
          <div class="control">
            <label for="bass">Bass</label>
            <div class="slider-container">
              <button class="eq-btn minus" data-target="bass">−</button>
              <input id="bass" type="range" min="-12" max="12" value="0" step="1" />
              <button class="eq-btn plus" data-target="bass">+</button>
            </div>
            <div class="value-display" id="bassValue">0dB</div>
          </div>
          <div class="control">
            <label for="treble">Treble</label>
            <div class="slider-container">
              <button class="eq-btn minus" data-target="treble">−</button>
              <input id="treble" type="range" min="-12" max="12" value="0" step="1" />
              <button class="eq-btn plus" data-target="treble">+</button>
            </div>
            <div class="value-display" id="trebleValue">0dB</div>
          </div>
          <div class="control">
            <label for="gain">Gain</label>
            <div class="slider-container">
              <button class="eq-btn minus" data-target="gain">−</button>
              <input id="gain" type="range" min="-12" max="12" value="0" step="1" />
              <button class="eq-btn plus" data-target="gain">+</button>
            </div>
            <div class="value-display" id="gainValue">0dB</div>
          </div>
          <div class="control">
            <label for="vol">Volume</label>
            <div class="slider-container">
              <button class="eq-btn minus" data-target="vol">−</button>
              <input id="vol" type="range" min="0" max="1" value="0.9" step="0.01" />
              <button class="eq-btn plus" data-target="vol">+</button>
            </div>
            <div class="value-display" id="volValue">90%</div>
          </div>
        </div>
        <canvas id="viz" aria-label="Audio visualizer"></canvas>
      </div>
      <div class="tracks">
        <div class="track" data-track="0">
          <div>
            <strong>Get Bonzied (Cut-Down)</strong>
            <small>2.9MB • Track 1/5</small>
          </div>
          <div class="row">
            <button data-load="Get Bonzied (Cut-Down)" data-src="https://raw.githubusercontent.com/aerovista-us/bonsaid/main/%E2%80%9CGet%20Bonzied%20(Cut-Down%20Version).mp3">▶ Play</button>
          </div>
        </div>
        <div class="track" data-track="1">
          <div>
            <strong>GET BONSAID – Ext. Growth</strong>
            <small>5.9MB • Track 2/5</small>
          </div>
          <div class="row">
            <button data-load="GET BONSAID – Ext. Growth" data-src="https://raw.githubusercontent.com/aerovista-us/bonsaid/main/GET%20BONSAID%20%E2%80%93%20Ext.%20Growth.mp3">▶ Play</button>
          </div>
        </div>
        <div class="track" data-track="2">
          <div>
            <strong>GROWTH (Preview)</strong>
            <small>2.9MB • Track 3/5</small>
          </div>
          <div class="row">
            <button data-load="GROWTH (Preview)" data-src="https://raw.githubusercontent.com/aerovista-us/bonsaid/main/GET%20BONSAID%20%E2%80%93%20GROWTH%20(pr).mp3">▶ Play</button>
          </div>
        </div>
        <div class="track" data-track="3">
          <div>
            <strong>GET BONSAID – GROWTH</strong>
            <small>3.2MB • Track 4/5</small>
          </div>
          <div class="row">
            <button data-load="GET BONSAID – GROWTH" data-src="https://raw.githubusercontent.com/aerovista-us/bonsaid/main/GET%20BONSAID%20%E2%80%93%20GROWTH.mp3">▶ Play</button>
          </div>
        </div>
        <div class="track" data-track="4">
          <div>
            <strong>Get Bonsaid (Cut-Down Alt)</strong>
            <small>2.9MB • Track 5/5</small>
          </div>
          <div class="row">
            <button data-load="Get Bonsaid (Cut-Down Alt)" data-src="https://raw.githubusercontent.com/aerovista-us/bonsaid/main/Get%20Bonsaid%20(Cut-Down%20Version).mp3">▶ Play</button>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Sticky Mobile Player -->
  <div class="sticky-player" id="sticky">
    <div class="row">
      <button id="playMobile" class="primary" style="min-width:74px">► Play</button>
      <div class="title" id="nowTitle">Get Bonzied (Cut-Down)</div>
      <div class="seek" id="seekMobile"><div class="fill" id="seekFillMobile"></div></div>
      <div id="timeMobile" style="min-width:70px;text-align:right;color:var(--muted)">0:00</div>
    </div>
    <!-- Mobile Visualizer -->
    <canvas id="vizMobile" aria-label="Audio visualizer" style="width:100%;height:120px;background:#0b0b0b;border-radius:8px;border:1px solid #222;margin:8px 0;"></canvas>
    <div class="row" style="margin-top:8px;gap:8px">
      <label for="bassMobile" class="stamp" style="font-size:11px;min-width:40px">Bass</label>
      <input id="bassMobile" type="range" min="-12" max="12" value="0" step="1" style="width:120px;height:48px;background:transparent;cursor:pointer;outline:none"/>
      <label for="trebleMobile" class="stamp" style="font-size:11px;min-width:50px">Treble</label>
      <input id="trebleMobile" type="range" min="-12" max="12" value="0" step="1" style="width:120px;height:48px;background:transparent;cursor:pointer;outline:none"/>
      <label for="volMobile" class="stamp" style="font-size:11px;min-width:30px">Vol</label>
      <input id="volMobile" type="range" min="0" max="1" value="0.9" step="0.01" style="width:100px;height:48px;background:transparent;cursor:pointer;outline:none"/>
    </div>
  </div>

  <footer>© <span id="yr"></span> AeroVista · BONSAID — All rights reserved.</footer>

<script>
(() => {
  const $ = s => document.querySelector(s);
  const audio = $('#audio');
  const playBtn = $('#play');
  const prevBtn = $('#prev');
  const nextBtn = $('#next');
  const seek = document.querySelector('.seek');
  const seekFill = $('#seekFill');
  const time = $('#time');
  const bassCtl = $('#bass');
  const trebleCtl = $('#treble');
  const gainCtl = $('#gain');
  const volCtl = $('#vol');
  const viz = $('#viz');
  const vizMobile = $('#vizMobile');
  const yr = $('#yr'); yr.textContent = new Date().getFullYear();

  // --- Enhanced Web Audio Graph ---
  const ctx = new (window.AudioContext || window.webkitAudioContext)();
  const src = ctx.createMediaElementSource(audio);
  const masterGain = ctx.createGain();
  
  // Enhanced EQ with multiple bands
  const lowShelf = ctx.createBiquadFilter(); 
  lowShelf.type = 'lowshelf'; 
  lowShelf.frequency.value = 90;
  lowShelf.gain.value = 0;
  
  const highShelf = ctx.createBiquadFilter();
  highShelf.type = 'highshelf';
  highShelf.frequency.value = 3000;
  highShelf.gain.value = 0;
  
  const compressor = ctx.createDynamicsCompressor();
  compressor.threshold.value = -24;
  compressor.knee.value = 30;
  compressor.ratio.value = 12;
  compressor.attack.value = 0.003;
  compressor.release.value = 0.25;
  
  const preGain = ctx.createGain();
  const analyser = ctx.createAnalyser(); 
  analyser.fftSize = 2048; // Higher resolution for better visualization
  analyser.smoothingTimeConstant = 0.8;

  // Enhanced chain: src -> preGain -> lowShelf -> highShelf -> compressor -> masterGain -> analyser -> destination
  src.connect(preGain);
  preGain.connect(lowShelf);
  lowShelf.connect(highShelf);
  highShelf.connect(compressor);
  compressor.connect(masterGain);
  masterGain.connect(analyser);
  analyser.connect(ctx.destination);

  // Enhanced audio controls with dramatic bass boost
  function setBass(db){ 
    // Dramatic bass boost at maximum setting
    if(db >= 12) {
      lowShelf.gain.value = db * 2; // Double the bass at max setting
    } else {
      lowShelf.gain.value = db; // Normal progression for other values
    }
  }
  function setTreble(db){ highShelf.gain.value = db; }
  function setGain(db){ preGain.gain.value = Math.pow(10, db/20); }
  function setVol(v){ masterGain.gain.value = v; }
  
  // Initialize controls
  setBass(parseFloat(bassCtl.value));
  setTreble(parseFloat(trebleCtl.value));
  setGain(parseFloat(gainCtl.value));
  setVol(parseFloat(volCtl.value));

  // Controls
  playBtn.addEventListener('click', async () => {
    if (ctx.state === 'suspended') await ctx.resume();
    if (audio.paused) { audio.play(); playBtn.textContent='❚❚ Pause'; }
    else { audio.pause(); playBtn.textContent='► Play'; }
  });

  // Navigation controls
  prevBtn.addEventListener('click', () => {
    const prevIndex = currentTrackIndex > 0 ? currentTrackIndex - 1 : tracks.length - 1;
    playTrack(prevIndex);
  });

  nextBtn.addEventListener('click', () => {
    nextTrack();
  });
  // Value display elements
  const bassValue = $('#bassValue');
  const trebleValue = $('#trebleValue');
  const gainValue = $('#gainValue');
  const volValue = $('#volValue');
  
  bassCtl.oninput = e => {
    setBass(parseFloat(e.target.value));
    bassValue.textContent = `${e.target.value}dB`;
  };
  trebleCtl.oninput = e => {
    setTreble(parseFloat(e.target.value));
    trebleValue.textContent = `${e.target.value}dB`;
  };
  gainCtl.oninput = e => {
    setGain(parseFloat(e.target.value));
    gainValue.textContent = `${e.target.value}dB`;
  };
  volCtl.oninput = e => {
    setVol(parseFloat(e.target.value));
    volValue.textContent = `${Math.round(e.target.value * 100)}%`;
  };

  // +/- Button handlers for EQ controls
  document.querySelectorAll('.eq-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      const target = btn.dataset.target;
      const isPlus = btn.classList.contains('plus');
      const control = $(`#${target}`);
      const valueDisplay = $(`#${target}Value`);
      
      if (!control) return;
      
      const currentValue = parseFloat(control.value);
      const step = target === 'vol' ? 0.01 : 1;
      const min = parseFloat(control.min);
      const max = parseFloat(control.max);
      
      let newValue;
      if (isPlus) {
        newValue = Math.min(max, currentValue + step);
      } else {
        newValue = Math.max(min, currentValue - step);
      }
      
      control.value = newValue;
      
      // Update the corresponding function
      if (target === 'bass') {
        setBass(newValue);
        valueDisplay.textContent = `${newValue}dB`;
      } else if (target === 'treble') {
        setTreble(newValue);
        valueDisplay.textContent = `${newValue}dB`;
      } else if (target === 'gain') {
        setGain(newValue);
        valueDisplay.textContent = `${newValue}dB`;
      } else if (target === 'vol') {
        setVol(newValue);
        valueDisplay.textContent = `${Math.round(newValue * 100)}%`;
      }
    });
  });

  // Seek bar
  audio.addEventListener('timeupdate', () => {
    if(!isFinite(audio.duration)) return;
    const p = audio.currentTime / audio.duration;
    seekFill.style.inset = `0 ${Math.max(0,100 - p*100)}% 0 0`;
    time.textContent = fmt(audio.currentTime) + ' / ' + fmt(audio.duration);
  });
  seek.addEventListener('click', e => {
    const r = seek.getBoundingClientRect();
    const p = (e.clientX - r.left) / r.width;
    if(isFinite(audio.duration)) audio.currentTime = Math.max(0, Math.min(1,p)) * audio.duration;
  });
  function fmt(s){ if(!isFinite(s)) return '0:00'; const m=Math.floor(s/60), sec=Math.floor(s%60).toString().padStart(2,'0'); return `${m}:${sec}`; }

  // Visualizer
  const g = viz.getContext('2d');
  const gMobile = vizMobile ? vizMobile.getContext('2d') : null;
  const buffer = new Uint8Array(analyser.frequencyBinCount);
  
  // Growth animation variables
  let growthTime = 0;
  let lastGrowth = 0;
  
  function drawVisualizer(canvas, context, isMobile = false) {
    if (!canvas || !context) return;
    
    analyser.getByteFrequencyData(buffer);
    const w = canvas.width = canvas.clientWidth * devicePixelRatio;
    const h = canvas.height = canvas.clientHeight * devicePixelRatio;
    context.clearRect(0,0,w,h);
    
    // Update growth animation
    growthTime += 0.02;
    
    // Hybrid Bonsai + Pine Tree Bars Visualizer
    const bars = isMobile ? 24 : 48;
    const step = Math.floor(buffer.length / bars);
    const centerX = w / 2;
    const baseY = h - 20;
    
    // Calculate side bar areas - edge aligned
    const leftBarStart = 0; // Start at left edge
    const rightBarStart = w; // Start at right edge  
    const barWidth = 20;
    
    // Calculate overall audio energy for growth
    const audioEnergy = buffer.reduce((sum, val) => sum + val, 0) / (buffer.length * 255);
    const growthFactor = Math.min(1, audioEnergy * 2);
    
    // Draw wider pine tree bars on both sides
    const sideBars = Math.floor(bars / 2.5); // Use more bars for each side (40% each)
    const centerBars = bars - (sideBars * 2);
    
    // Left side pine tree bars - left aligned to edge
    for(let i = 0; i < sideBars; i++){
      const v = buffer[i * step] / 255;
      if (v < 0.05) continue;
      
      const barHeight = v * (h * 0.8);
      const barX = leftBarStart + (i / sideBars) * (barWidth * 6); // Left aligned spread
      const barY = baseY - barHeight;
      const barWidth2 = 20 + v * 40; // Keep same width as before
      
      // Draw wider pine tree-shaped bar
      context.fillStyle = `rgba(139, 195, 74, ${v * 0.8})`;
      context.beginPath();
      context.moveTo(barX, baseY);
      context.lineTo(barX + barWidth2/2, barY);
      context.lineTo(barX + barWidth2, baseY);
      context.closePath();
      context.fill();
      
      // Add more pine needles texture for wider bars
      for(let j = 0; j < Math.floor(v * 20); j++){
        const needleX = barX + Math.random() * barWidth2;
        const needleY = barY + Math.random() * barHeight;
        const needleSize = Math.random() * 2 + 1;
        
        context.fillStyle = `rgba(101, 153, 74, ${v * 0.6})`;
        context.beginPath();
        context.arc(needleX, needleY, needleSize, 0, Math.PI * 2);
        context.fill();
      }
    }
    
    // Right side pine tree bars - right aligned to edge and 50% wider
    for(let i = 0; i < sideBars; i++){
      const v = buffer[(sideBars + centerBars + i) * step] / 255;
      if (v < 0.05) continue;
      
      const barHeight = v * (h * 0.8);
      const barX = rightBarStart - (i / sideBars) * (barWidth * 9); // Right aligned spread (50% wider)
      const barY = baseY - barHeight;
      const barWidth2 = 30 + v * 60; // 50% wider bars (30-90px vs 20-60px)
      
      // Draw wider pine tree-shaped bar
      context.fillStyle = `rgba(139, 195, 74, ${v * 0.8})`;
      context.beginPath();
      context.moveTo(barX, baseY);
      context.lineTo(barX - barWidth2/2, barY);
      context.lineTo(barX - barWidth2, baseY);
      context.closePath();
      context.fill();
      
      // Add more pine needles texture for wider bars
      for(let j = 0; j < Math.floor(v * 20); j++){
        const needleX = barX - Math.random() * barWidth2;
        const needleY = barY + Math.random() * barHeight;
        const needleSize = Math.random() * 2 + 1;
        
        context.fillStyle = `rgba(101, 153, 74, ${v * 0.6})`;
        context.beginPath();
        context.arc(needleX, needleY, needleSize, 0, Math.PI * 2);
        context.fill();
      }
    }
    
    // Draw bonsai pot/container
    context.fillStyle = '#8B4513';
    context.fillRect(centerX - 30, baseY - 10, 60, 20);
    
    // Draw soil
    context.fillStyle = '#654321';
    context.fillRect(centerX - 25, baseY - 8, 50, 8);
    
    // Short, wide bonsai trunk with more authentic proportions
    const trunkHeight = Math.max(25, (buffer[0] / 255) * (h * 0.5)); // Shorter trunk
    const sway = Math.sin(growthTime * 2) * 1.5 * growthFactor;
    const trunkSway = Math.sin(growthTime * 1.5) * 1 * growthFactor;
    
    // Draw thicker, more gnarled trunk with S-curve
    context.strokeStyle = '#3A3A3A';
    context.lineWidth = 14;
    context.lineCap = 'round';
    context.beginPath();
    context.moveTo(centerX + sway, baseY);
    // Add S-curve to trunk
    context.quadraticCurveTo(
      centerX + trunkSway + 5, baseY - trunkHeight * 0.3,
      centerX + trunkSway, baseY - trunkHeight
    );
    context.stroke();
    
    // Add trunk texture and gnarling
    for(let i = 0; i < 3; i++){
      const knotX = centerX + trunkSway + (Math.random() - 0.5) * 8;
      const knotY = baseY - trunkHeight + Math.random() * trunkHeight;
      const knotSize = Math.random() * 3 + 2;
      
      context.fillStyle = `rgba(50, 50, 50, 0.6)`;
      context.beginPath();
      context.arc(knotX, knotY, knotSize, 0, Math.PI * 2);
      context.fill();
    }
    
    // Draw root system first (underground)
    for(let i = 0; i < 8; i++){
      const rootAngle = (i / 8) * Math.PI * 2;
      const rootLength = (buffer[i * 4] / 255) * 25;
      const rootX = centerX + Math.cos(rootAngle) * rootLength;
      const rootY = baseY + Math.sin(rootAngle) * rootLength * 0.3;
      
      context.strokeStyle = `rgba(101, 67, 33, ${0.6})`;
      context.lineWidth = 3;
      context.beginPath();
      context.moveTo(centerX, baseY);
      context.lineTo(rootX, rootY);
      context.stroke();
    }
    
    // Draw short, wide bonsai with clear horizontal layers
    const padCount = Math.min(6, Math.floor(audioEnergy * 10) + 4); // 4-6 pads for layered structure
    const padPositions = [];
    
    // Create distinct horizontal foliage layers
    for(let p = 0; p < padCount; p++){
      const padEnergy = buffer[(sideBars + p * Math.floor(centerBars / padCount)) * step] / 255;
      if (padEnergy < 0.05) continue;
      
      // Position pads in clear horizontal layers (short and wide)
      const layerHeight = baseY - trunkHeight + (p / (padCount - 1)) * trunkHeight * 0.8;
      const layerWidth = 20 + padEnergy * 50; // Much wider layers
      const padX = centerX + trunkSway + (Math.random() - 0.5) * layerWidth;
      const padY = layerHeight;
      
      padPositions.push({x: padX, y: padY, energy: padEnergy, layer: p});
      
      // Draw multiple branches for each layer
      for(let b = 0; b < 3; b++){
        const branchAngle = (b / 3) * Math.PI * 1.5 - Math.PI * 0.75; // Spread branches
        const branchLength = 15 + padEnergy * 25;
        const branchX = centerX + trunkSway + Math.cos(branchAngle) * branchLength;
        const branchY = layerHeight + Math.sin(branchAngle) * branchLength * 0.1;
        
        // Draw branch
        context.strokeStyle = `rgba(60, 60, 60, ${padEnergy * 0.8})`;
        context.lineWidth = Math.max(2, padEnergy * 4);
        context.beginPath();
        context.moveTo(centerX + trunkSway, layerHeight);
        context.quadraticCurveTo(
          centerX + trunkSway + Math.cos(branchAngle) * branchLength * 0.6,
          layerHeight - 3,
          branchX, branchY
        );
        context.stroke();
      }
    }
    
    // Draw clear horizontal foliage layers
    padPositions.forEach((pad, index) => {
      const padSway = Math.sin(growthTime * 1.2 + index * 0.4) * 1 * pad.energy; // Gentle sway
      const padX = pad.x + padSway;
      const padY = pad.y;
      const layerWidth = 25 + pad.energy * 40; // Wide horizontal layers
      const layerHeight = 8 + pad.energy * 12; // Short height
      const padDensity = Math.floor(pad.energy * 8) + 3;
      
      // Create wide, flat foliage layers
      context.fillStyle = `rgba(139, 195, 74, ${pad.energy * 0.8})`;
      context.beginPath();
      
      // Draw wide, flat layer shape
      const layerPoints = 12;
      for(let i = 0; i < layerPoints; i++){
        const angle = (i / layerPoints) * Math.PI * 2;
        const radiusX = layerWidth + Math.sin(angle * 3) * layerWidth * 0.1;
        const radiusY = layerHeight + Math.sin(angle * 2) * layerHeight * 0.3;
        const x = padX + Math.cos(angle) * radiusX;
        const y = padY + Math.sin(angle) * radiusY;
        
        if (i === 0) {
          context.moveTo(x, y);
        } else {
          context.lineTo(x, y);
        }
      }
      context.closePath();
      context.fill();
      
      // Add layer texture with more detail
      for(let i = 0; i < padDensity; i++){
        const textureX = padX + (Math.random() - 0.5) * layerWidth;
        const textureY = padY + (Math.random() - 0.5) * layerHeight;
        const textureSize = Math.random() * 2 + 1;
        
        context.fillStyle = `rgba(101, 153, 74, ${pad.energy * 0.6})`;
        context.beginPath();
        context.arc(textureX, textureY, textureSize, 0, Math.PI * 2);
        context.fill();
      }
      
      // Add layer highlight for depth
      if (pad.energy > 0.4) {
        context.fillStyle = `rgba(255, 255, 255, ${pad.energy * 0.2})`;
        context.beginPath();
        context.ellipse(padX, padY - layerHeight * 0.3, layerWidth * 0.6, layerHeight * 0.4, 0, 0, Math.PI * 2);
        context.fill();
      }
    });
    
    // Add floating particles (like pollen or seeds) with organic movement
    for(let i = 0; i < 8; i++){
      const particleX = (Math.random() * w) + Math.sin(growthTime * 1.5 + i) * 10;
      const particleY = (Math.random() * h * 0.7) + Math.cos(growthTime * 2 + i) * 5;
      const particleSize = Math.random() * 3 + 1;
      const opacity = Math.random() * 0.6 + 0.2;
      const particleFloat = Math.sin(growthTime * 3 + i * 0.5) * 0.5 + 1;
      
      context.fillStyle = `rgba(255, 255, 255, ${opacity})`;
      context.beginPath();
      context.arc(particleX, particleY, particleSize * particleFloat, 0, Math.PI * 2);
      context.fill();
      
      // Add particle trail for high energy
      if (audioEnergy > 0.5) {
        context.fillStyle = `rgba(139, 195, 74, ${opacity * 0.3})`;
        context.beginPath();
        context.arc(particleX, particleY, particleSize * 0.5, 0, Math.PI * 2);
        context.fill();
      }
    }
    
    // Add growth rings on trunk with pulsing effect
    const ringCount = Math.floor(trunkHeight / 15);
    for(let i = 1; i < ringCount; i++){
      const ringY = baseY - (i * 15);
      const ringPulse = Math.sin(growthTime * 2 + i * 0.5) * 0.2 + 1;
      context.strokeStyle = `rgba(139, 195, 74, ${0.3 * ringPulse})`;
      context.lineWidth = 1;
      context.beginPath();
      context.arc(centerX + trunkSway, ringY, 4 * ringPulse, 0, Math.PI * 2);
      context.stroke();
    }
    
    // Add moss/lichen on trunk for high energy
    if (audioEnergy > 0.6) {
      for(let i = 0; i < 3; i++){
        const mossX = centerX + trunkSway + (Math.random() - 0.5) * 8;
        const mossY = baseY - trunkHeight + Math.random() * trunkHeight;
        const mossSize = Math.random() * 4 + 2;
        
        context.fillStyle = `rgba(101, 153, 74, 0.4)`;
        context.beginPath();
        context.arc(mossX, mossY, mossSize, 0, Math.PI * 2);
        context.fill();
      }
    }
  }
  
  function draw(){
    requestAnimationFrame(draw);
    // Draw desktop visualizer
    drawVisualizer(viz, g, false);
    // Draw mobile visualizer if it exists
    if (vizMobile && gMobile) {
      drawVisualizer(vizMobile, gMobile, true);
    }
  }
  draw();

  // --- Mobile sticky controls (bind if present) ---
  const playM = document.getElementById('playMobile');
  const seekM = document.getElementById('seekMobile');
  const seekFillM = document.getElementById('seekFillMobile');
  const timeM = document.getElementById('timeMobile');
  const bassM = document.getElementById('bassMobile');
  const trebleM = document.getElementById('trebleMobile');
  const volM  = document.getElementById('volMobile');
  const nowTitle = document.getElementById('nowTitle');

  function syncMobile(){
    if(!timeM) return;
    timeM.textContent = fmt(audio.currentTime);
    if(isFinite(audio.duration)){
      const p = audio.currentTime / audio.duration;
      seekFillM && (seekFillM.style.inset = `0 ${Math.max(0,100 - p*100)}% 0 0`);
    }
  }

  if(playM){
    playM.addEventListener('click', async ()=>{
      if (ctx.state === 'suspended') await ctx.resume();
      if (audio.paused){ audio.play(); playM.textContent='❚❚ Pause'; }
      else { audio.pause(); playM.textContent='► Play'; }
    });
  }
  if(seekM){
    seekM.addEventListener('click', e => {
      const r = seekM.getBoundingClientRect();
      const p = (e.clientX - r.left) / r.width;
      if(isFinite(audio.duration)) audio.currentTime = Math.max(0, Math.min(1,p)) * audio.duration;
    });
  }
  if(bassM){ bassM.oninput = e => { setBass(parseFloat(e.target.value)); bassCtl.value = e.target.value; }; }
  if(trebleM){ trebleM.oninput = e => { setTreble(parseFloat(e.target.value)); trebleCtl.value = e.target.value; }; }
  if(volM){ volM.oninput  = e => { setVol(parseFloat(e.target.value)); volCtl.value = e.target.value; }; }

  audio.addEventListener('timeupdate', syncMobile);

  // update title when loading tracks
  document.querySelectorAll('button[data-load]').forEach(btn => {
    btn.addEventListener('click', () => {
      nowTitle && (nowTitle.textContent = btn.dataset.load);
      if(playM) playM.textContent='❚❚ Pause';
    });
  });

  // Playlist functionality
  let currentTrackIndex = 0;
  
  // Track data - using GitHub raw URLs
  const tracks = [
    { name: "Get Bonzied (Cut-Down)", src: "https://raw.githubusercontent.com/aerovista-us/bonsaid/main/%E2%80%9CGet%20Bonzied%20(Cut-Down%20Version).mp3" },
    { name: "GET BONSAID – Ext. Growth", src: "https://raw.githubusercontent.com/aerovista-us/bonsaid/main/GET%20BONSAID%20%E2%80%93%20Ext.%20Growth.mp3" },
    { name: "GROWTH (Preview)", src: "https://raw.githubusercontent.com/aerovista-us/bonsaid/main/GET%20BONSAID%20%E2%80%93%20GROWTH%20(pr).mp3" },
    { name: "GET BONSAID – GROWTH", src: "https://raw.githubusercontent.com/aerovista-us/bonsaid/main/GET%20BONSAID%20%E2%80%93%20GROWTH.mp3" },
    { name: "Get Bonsaid (Cut-Down Alt)", src: "https://raw.githubusercontent.com/aerovista-us/bonsaid/main/Get%20Bonsaid%20(Cut-Down%20Version).mp3" }
  ];

  function updateTrackDisplay() {
    document.querySelectorAll('.track').forEach(track => track.classList.remove('playing', 'queued'));
    const currentTrack = document.querySelector(`[data-track="${currentTrackIndex}"]`);
    if(currentTrack) currentTrack.classList.add('playing');
  }

  function playTrack(index) {
    if(index >= 0 && index < tracks.length) {
      currentTrackIndex = index;
      const track = tracks[index];
      audio.src = track.src;
      audio.play();
      playBtn.textContent = '❚❚ Pause';
      if(playM) playM.textContent = '❚❚ Pause';
      if(nowTitle) nowTitle.textContent = track.name;
      updateTrackDisplay();
    }
  }

  function nextTrack() {
    const nextIndex = (currentTrackIndex + 1) % tracks.length;
    playTrack(nextIndex);
  }

  // Auto-advance to next track
  audio.addEventListener('ended', () => {
    nextTrack();
  });

  // Preload first track on page load
  function preloadFirstTrack() {
    if(tracks.length > 0) {
      audio.src = tracks[0].src;
      if(nowTitle) nowTitle.textContent = tracks[0].name;
      updateTrackDisplay();
      updateLoadedTrack();
    }
  }

  // Initialize first track when page loads
  preloadFirstTrack();

  // Add visual indicator for loaded track
  function updateLoadedTrack() {
    document.querySelectorAll('.track').forEach(track => {
      track.classList.remove('loaded');
    });
    const currentTrack = document.querySelector(`[data-track="${currentTrackIndex}"]`);
    if(currentTrack) currentTrack.classList.add('loaded');
  }

  // Track loading - simplified showcase mode
  document.querySelectorAll('button[data-load]').forEach(btn => {
    btn.addEventListener('click', () => {
      const trackElement = btn.closest('.track');
      const trackIndex = parseInt(trackElement.dataset.track);
      playTrack(trackIndex);
    });
  });


  // Slideshow functionality
  let currentSlide = 0;
  let slides = [];
  const slideshowContainer = document.getElementById('slideshow');
  const indicators = document.getElementById('indicators');
  const prevSlideBtn = document.getElementById('prevSlide');
  const nextSlideBtn = document.getElementById('nextSlide');
  
  // All images from slideshow directory
  const slideshowImages = [
    { src: 'slideshow/A sleek bonsai tree .png', badge: 'Bonsai Tree' },
    { src: 'slideshow/A sleek bonsai tree_no.bg .png', badge: 'Bonsai Tree (No BG)' },
    { src: 'slideshow/b94d7e21-7ddc-42cc-97fd-6cf2f2a15882.png', badge: 'Album Art' },
    { src: 'slideshow/claypot.jpeg', badge: 'Clay Pot' },
    { src: 'slideshow/cracked pot.jpeg', badge: 'Cracked Pot' },
    { src: 'slideshow/d8c1b8ae-a197-4299-bb7b-6c24ea68df53.png', badge: 'Album Art 2' },
    { src: 'slideshow/dowzznload.jpeg', badge: 'Download' },
    { src: 'slideshow/rootbust.png', badge: 'Root Bust' },
    { src: 'slideshow/Trim mad.png', badge: 'Trim Mad' },
    { src: 'slideshow/trim.png', badge: 'Trim' },
    { src: 'slideshow/watered.png', badge: 'Watered' }
  ];
  
  // Randomize images on page load
  function shuffleArray(array) {
    const shuffled = [...array];
    for (let i = shuffled.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
    }
    return shuffled;
  }
  
  // Initialize slideshow with randomized images
  function initializeSlideshow() {
    const randomizedImages = shuffleArray(slideshowImages);
    
    // Clear existing slides
    slideshowContainer.innerHTML = '';
    indicators.innerHTML = '';
    
    // Create slides dynamically
    randomizedImages.forEach((image, index) => {
      const slide = document.createElement('div');
      slide.className = 'slide';
      if (index === 0) slide.classList.add('active');
      slide.style.backgroundImage = `url('${image.src}')`;
      slide.setAttribute('data-track', index);
      
      const badge = document.createElement('span');
      badge.className = 'badge';
      badge.textContent = image.badge;
      slide.appendChild(badge);
      
      slideshowContainer.appendChild(slide);
    });
    
    // Update slides reference
    slides = document.querySelectorAll('.slide');
    
    // Create indicators
    slides.forEach((_, index) => {
      const indicator = document.createElement('div');
      indicator.className = 'indicator';
      if(index === 0) indicator.classList.add('active');
      indicator.addEventListener('click', () => goToSlide(index));
      indicators.appendChild(indicator);
    });
  }
  
  // Initialize slideshow on page load
  initializeSlideshow();
  
  function goToSlide(index) {
    if (slides.length === 0) return;
    
    slides[currentSlide].classList.remove('active');
    indicators.children[currentSlide].classList.remove('active');
    
    currentSlide = index;
    slides[currentSlide].classList.add('active');
    indicators.children[currentSlide].classList.add('active');
  }
  
  function nextSlide() {
    if (slides.length === 0) return;
    const next = (currentSlide + 1) % slides.length;
    goToSlide(next);
  }
  
  function prevSlide() {
    if (slides.length === 0) return;
    const prev = (currentSlide - 1 + slides.length) % slides.length;
    goToSlide(prev);
  }
  
  // Event listeners
  nextSlideBtn.addEventListener('click', nextSlide);
  prevSlideBtn.addEventListener('click', prevSlide);
  
  // Auto-rotate slideshow every 4 seconds
  let slideshowInterval;
  
  function startSlideshow() {
    if (slideshowInterval) clearInterval(slideshowInterval);
    slideshowInterval = setInterval(() => {
      if (slides.length > 0) {
        nextSlide();
      }
    }, 4000);
  }
  
  // Start slideshow after initialization
  setTimeout(startSlideshow, 1000);
})();
</script>
</body>
</html>
